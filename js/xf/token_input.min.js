!function(f,h,k,l){XF.TokenInput=XF.Element.newHandler({options:{tokens:[","],minLength:2,maxLength:0,maxTokens:0,selectOnClose:!1,acUrl:"",listData:{}},$container:null,$selection:null,$hiddenInput:null,init:function(){var a=this.$target,b=this.options,c=a.clone().insertAfter(a).prop("type","hidden").removeAttr("data-xf-init").removeAttr("id"),e={tags:!0,width:"100%",containerCssClass:"input",language:XF.TokenInput.Phrases,minimumInputLength:b.minLength,maximumInputLength:b.maxLength,maximumSelectionLength:b.maxTokens,
selectOnClose:b.selectOnClose,disabled:a.prop("disabled"),placeholder:this.$target.attr("placeholder")};try{e.tokenSeparators=f.parseJSON(b.tokens)}catch(m){e.tokenSeparators=b.tokens}b.acUrl&&(e.ajax={delay:250,data:XF.proxy(this,"prepareAjax"),transport:XF.proxy(this,"getAjax"),processResults:XF.proxy(this,"processAjax")},e.escapeMarkup=function(a){return a},e.sorter=XF.proxy(this,"sortResults"),e.templateResult=XF.proxy(this,"prepareResults"),e.templateSelection=XF.proxy(this,"prepareSelection"));
if(b.listData){var g=[];f.each(b.listData,function(a,b){g.push({id:a,text:b})});e.data=g}a.remove();var d=f('<select name="tokens_select" multiple="multiple" class="js-tokenSelect"></select>').insertBefore(c).select2(e);c.val()&&(b=c.val().split(",").map(f.trim),f.each(b,function(a,b){f("<option selected>").val(b).text(b).appendTo(d)}),d.trigger("change"));this.$hiddenInput=c;c=d.data("select2");this.$container=c.$container;this.$selection=c.$selection;c.on("results:message",function(a){this.dropdown._resizeDropdown();
this.dropdown._positionDropdown()});a.attr("autofocus")&&(d.select2("open"),c.$selection.addClass("is-focused"));a=d.closest(".overlay-container");if(a.length)a.on("overlay:hiding",function(){d.select2("close")});d.on("select2:unselecting",function(a){XF.MenuWatcher.preventDocClick()});d.on("select2:unselect",function(a){setTimeout(function(){XF.MenuWatcher.allowDocClick()},0)});c.$container.on("focusin focusout",XF.proxy(this,"inputFocusBlur"));d.on("change",XF.proxy(this,"updateInput"));d.closest("form").on("reset",
function(){d.val(null).trigger("change")})},prepareAjax:function(a){return{q:a.term}},getAjax:function(a,b,c){return XF.ajax("get",this.options.acUrl,a.data,b)},processAjax:function(a,b){return"object"!=typeof a?{}:a},sortResults:function(a){if(1>=a.length)return a;a.hasOwnProperty(0)&&(a[0].hasOwnProperty("q")||a.push(a.shift()));return a},prepareResults:function(a){a.styledText=a.text;if(a.q){var b=new RegExp("("+XF.regexQuote(a.q)+")","i");a.styledText=XF.htmlspecialchars(a.styledText).replace(b,
"<strong>$1</strong>")}else a.disabled||(a.styledText="<strong>"+XF.htmlspecialchars(a.styledText)+"</strong>");b=a.styledText;a.iconHtml&&(b=a.iconHtml+"&nbsp;"+b);return b},prepareSelection:function(a){return XF.htmlspecialchars(a.text)},inputFocusBlur:function(a){switch(a.type){case "focusout":this.$selection.removeClass("is-focused");break;default:this.$selection.addClass("is-focused")}},updateInput:function(a){a=f(a.target);var b=this.$hiddenInput;a.val()?b.val(a.val().join(", ")):b.val("")}});
XF.TokenInput.Phrases={errorLoading:function(){return XF.phrase("s2_error_loading")},inputTooLong:function(a){return XF.phrase("s2_input_too_long",{"{count}":a.input.length-a.maximum})},inputTooShort:function(a){return XF.phrase("s2_input_too_short",{"{count}":a.minimum-a.input.length})},loadingMore:function(){return XF.phrase("s2_loading_more")},maximumSelected:function(a){return XF.phrase("s2_maximum_selected",{"{count}":a.maximum})},noResults:function(){return XF.phrase("s2_no_results")},searching:function(){return XF.phrase("s2_searching")}};
XF.Element.register("token-input","XF.TokenInput")}(jQuery,window,document);
